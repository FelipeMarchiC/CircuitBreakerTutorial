server:
  port: 8080

spring:
  application:
    name: circuit_breaker

weather:
  api:
    key: ${WEATHER_API_KEY:default-key-if-missing}

resilience4j:
  circuitbreaker:
    instances:
      weatherApi:
        sliding-window-size: 5                                    # Número de chamadas monitoradas
        failure-rate-threshold: 50                                # Porcentagem de falhas que abre o circuito
        wait-duration-in-open-state: 5s                           # Tempo de espera antes de reabrir
        permitted-number-of-calls-in-half-open-state: 3           # Número de chamadas permitidas no estado meio-aberto
        automatic-transition-from-open-to-half-open-enabled: true # Transição automática de estado aberto para meio-aberto
  timelimiter:
    instances:
      weatherApi:
        timeout-duration:
          seconds: 10
  retry:
    instances:
      weatherApi:
        max-attempts: 2
        wait-duration:
          seconds: 1
        retry-exceptions:
          - java.lang.RuntimeException


logging:
  level:
    io.github.resilience4j.circuitbreaker: DEBUG
management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
    circuitbreakers:
      enabled: true
  health:
    circuitbreakers:
      enabled: true